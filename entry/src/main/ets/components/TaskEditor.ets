// File: entry/src/main/ets/components/TaskEditor.ets

import { TaskNode } from '../model/ProjectData';

@Component
export struct TaskEditor {
  task: TaskNode | null = null;

  onUpdateTask: (id: string, name: string, duration: number) => void = () => {};
  onDeleteTask: (id: string) => void = () => {};
  onBack: () => void = () => {};
  // æ–°å¢žï¼šåˆ›å»ºè¿žæŽ¥çš„å›žè°ƒå‡½æ•°
  onStartConnecting: () => void = () => {};

  build() {
    if (this.task) {
      Column({ space: 15 }) {
        Text(`ç¼–è¾‘: ${this.task.name}`)
          .fontSize(20)
          .fontWeight(FontWeight.Bold)
          .width('100%')
          .textAlign(TextAlign.Start)

        Text('ä»»åŠ¡åç§°').width('100%').fontColor(Color.Gray)
        TextInput({ text: this.task.name })
          .onChange((value: string) => {
            if (this.task) {
              this.onUpdateTask(this.task.id, value, this.task.duration);
            }
          })

        Text('å·¥æœŸ (å¤©)').width('100%').fontColor(Color.Gray)
        TextInput({ text: this.task.duration.toString() })
          .type(InputType.Number)
          .onChange((value: string) => {
            if (this.task) {
              const duration = parseInt(value) || 0;
              this.onUpdateTask(this.task.id, this.task.name, duration);
            }
          })

        // æ–°å¢žï¼šåˆ›å»ºä¾èµ–çš„æŒ‰é’®
        Button('ðŸ”— åˆ›å»ºä¾èµ–ä»Žæ­¤ä»»åŠ¡å¼€å§‹')
          .width('100%')
          .type(ButtonType.Normal)
          .margin({ top: 20 })
          .onClick(() => {
            this.onStartConnecting();
          })

        Blank()

        Button('åˆ é™¤æ­¤ä»»åŠ¡')
          .width('100%')
          .type(ButtonType.Capsule)
          .backgroundColor(Color.Red)
          .onClick(() => {
            if (this.task) {
              this.onDeleteTask(this.task.id);
            }
          })

        Button('è¿”å›žåˆ—è¡¨')
          .width('100%')
          .type(ButtonType.Normal)
          .margin({ top: 10 })
          .onClick(() => {
            this.onBack();
          })
      }
      .alignItems(HorizontalAlign.Start)
      .height('100%')
    }
  }
}
